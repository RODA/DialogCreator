{"id":"8724bbcd-e073-4ac3-95a3-405999be0d80","properties":{"name":"Recode","title":"Recode into (different) variables","width":"540","height":"365","fontSize":"12"},"syntax":{"command":"","defaultElements":[]},"customJS":"let recoded_variable = '';\nlet selected_dataset = '<dataset>';\nlet selected_variable = '<variable>';\nlet old_value = '';\nlet new_value = '';\n\nsetValue(c_datasets, listDatasets());\n\nonChange(c_datasets, () => {\n  clearError(c_datasets);\n  selected_dataset = getSelected(c_datasets);\n  setValue(c_variables, listVariables(selected_dataset));\n  selected_variable = '<variable>';\n  updateSyntax(buildCommand());\n});\n\nonChange(c_variables, () => {\n  clearError(c_variables);\n  selected_variable = getSelected(c_variables);\n  triggerChange(checkbox1); // to update recoded_variable\n  updateSyntax(buildCommand());\n});\n\nonClick(i_value_old, () => check(r_old1));\nonClick(i_lowesto, () => check(r_old2));\nonClick(i_from, () => check(r_old3));\nonClick(i_to, () => check(r_old3));\nonClick(i_tohighest, () => check(r_old4));\nonClick(i_value_new, () => check(r_new1));\n\nonChange(radiogroup1, () => {\n  if (isChecked(r_old1)) triggerChange(i_value_old);\n  if (isChecked(r_old2)) triggerChange(i_lowesto);\n  if (isChecked(r_old3)) triggerChange(i_from); // also checks i_to\n  if (isChecked(r_old4)) triggerChange(i_tohighest);\n  if (isChecked(r_old5)) old_value = \"missing\";\n  if (isChecked(r_old6)) old_value = \"else\";\n});\n\nonChange(radiogroup2, () => {\n  if (isChecked(r_new1)) triggerChange(i_value_new);\n  if (isChecked(r_new2)) new_value = 'missing';\n  if (isChecked(r_new3)) new_value = 'copy';\n});\n\nonChange(i_value_old, () => old_value = getValue(i_value_old));\n\nonChange(i_lowesto, () => {\n  const lowesto = getValue(i_lowesto);\n  old_value = lowesto ? 'lo:' + lowesto : '';\n  //old_value = '';\n  //if (lowesto) {\n    //old_value = 'lo:' + lowesto;\n  //}\n});\n\n// delegate to i_to\nonChange(i_from, () => triggerChange(i_to));\n\nonChange(i_to, () => {\n  const from = getValue(i_from);\n  const to = getValue(i_to);\n  old_value = (from && to) ? from + ':' + to : '';\n});\n\nonChange(i_tohighest, () => {\n  const tohighest = getValue(i_tohighest);\n  old_value = tohighest ? tohighest + ':hi' : '';\n});\n\nonChange(i_value_new, () => new_value = getValue(i_value_new));\n\nonClick(b_add, () => {\n  if (old_value && new_value) {\n    addValue(c_rules, old_value + '=' + new_value);\n    clearContent(i_value_old);\n    clearContent(i_lowesto);\n    clearContent(i_from);\n    clearContent(i_to);\n    clearContent(i_tohighest);\n    clearContent(i_value_new);\n    clearError(c_rules);\n    updateSyntax(buildCommand());\n  } else if (old_value) {\n    addError(c_rules, 'new value not defined');\n  } else if (new_value) {\n    addError(c_rules, 'old value not defined');\n  } else {\n    addError(c_rules, 'old and new values needed');\n  }\n});\n\nonClick(b_remove, () => {\n  clearValue(c_rules, getSelected(c_rules));\n  updateSyntax(buildCommand());\n});\n\nonClick(b_clear, () => {\n  clearContainer(c_rules);\n  updateSyntax(buildCommand());\n});\n\nonChange(checkbox1, () => {\n  if (isChecked(checkbox1)) {\n    show(i_newvar);\n    const newvar = getValue(i_newvar);\n    recoded_variable = newvar ? newvar : selected_variable;\n    updateSyntax(buildCommand());\n  } else {\n    hide(i_newvar);\n    recoded_variable = selected_variable;\n    updateSyntax(buildCommand());\n  }\n});\n\nonChange(i_newvar, () => {\n  clearError(i_newvar);\n  const newvar = getValue(i_newvar);\n  recoded_variable = newvar ? newvar : selected_variable;\n  updateSyntax(buildCommand());\n});\n\nconst buildCommand = () => {\n  const rules = getValue(c_rules);\n  triggerChange(checkbox1); // to update recoded_variable\n  \n  let command = 'inside(\\n  ' + selected_dataset + ',\\n  ';\n  command += recoded_variable + ' <- recode(\\n    ';\n  command += selected_variable + ',\\n    rules = \"';\n  command += rules ? rules.join('; ') : '';\n  command += '\"\\n  )\\n)\\n';\n  return command;\n}\n\nonClick(b_run, () => {\n  if (selected_dataset === '<dataset>') {\n    addError(c_datasets, \"No dataset selected\");\n    return;\n  }\n  \n  if (selected_variable === '<variable>') {\n    addError(c_variables, \"No variable selected\");\n    return;\n  }\n  \n  if (!getValue(c_rules)) {\n    addError(c_rules, \"No recoding rules\");\n    return;\n  }\n\n  if (isChecked(checkbox1)) {\n    const newvar = getValue(i_newvar);\n    if (!newvar) {\n      addError(i_newvar, \"New variable needs a name.\")\n    }\n  } else {\n    clearError(i_newvar);\n  }\n\n  run(buildCommand());\n});\n\nupdateSyntax(buildCommand());\n","elements":[{"id":"2904b8c1-268a-4ea4-bf8e-fceea1e2d435","type":"Container","nameid":"c_rules","left":350,"top":178,"width":170,"height":125,"selection":"multiple","itemType":"any","backgroundColor":"#ffffff","fontColor":"#000000","activeBackgroundColor":"#589658","activeFontColor":"#ffffff","disabledBackgroundColor":"#dedede","borderColor":"#b8b8b8","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"47f8d38d-b45b-4509-b7b2-02a660c2c63f","type":"Container","nameid":"c_datasets","left":20,"top":38,"width":130,"height":100,"selection":"single","itemType":"any","backgroundColor":"#ffffff","fontColor":"#000000","activeBackgroundColor":"#589658","activeFontColor":"#ffffff","disabledBackgroundColor":"#dedede","borderColor":"#b8b8b8","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"abc85ac9-5e5b-4f84-9173-9cbdf6e503f6","left":405,"top":150,"nameid":"b_remove","type":"Button","label":"Remove","width":60,"lineClamp":1,"color":"#efefef","fontColor":"#000000","borderColor":"#939393","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"e8ae43b3-2ee7-4b59-b348-3355d1f5ba8a","left":470,"top":327,"nameid":"b_run","type":"Button","label":"Run","width":50,"lineClamp":1,"color":"#efefef","fontColor":"#000000","borderColor":"#727272","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"8422d5db-7026-44d2-b154-8ebeebc637e7","left":470,"top":150,"nameid":"b_clear","type":"Button","label":"Clear","width":50,"lineClamp":1,"color":"#efefef","fontColor":"#000000","borderColor":"#939393","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"f707a9cd-7a5d-449e-8eea-3cae50a53ee9","nameid":"b_add","type":"Button","label":"Add","left":350,"top":150,"width":50,"lineClamp":1,"color":"#efefef","fontColor":"#000000","borderColor":"#939393","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"a2db3001-8851-48f1-b4c6-e5c336e5f829","type":"Label","nameid":"label1","left":20,"top":18,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"Dataset:","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"cf6caef0-7f85-4a44-a4b9-140014d62848","type":"Label","nameid":"label2","left":20,"top":160,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"Choose variable:","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"912d15ce-a967-4d70-81fd-52101ef9fa7c","type":"Radio","nameid":"r_old1","group":"radiogroup1","left":170,"top":55,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"8ed7331e-8e1b-4529-a3bf-1b0981f82b9c","type":"Label","nameid":"label5","left":193,"top":55,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"value","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"907c5602-04c4-4198-ba51-fe88868512b0","type":"Label","nameid":"label4","left":170,"top":20,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"Old value(s):","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"652b3bfe-4025-4292-95e3-1c71e9ed809b","type":"Radio","nameid":"r_old2","group":"radiogroup1","left":170,"top":100,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"f3d462c4-a893-44fc-aaf9-fd4723e5c2fb","type":"Radio","nameid":"r_old3","group":"radiogroup1","left":170,"top":145,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"51ad1de6-4719-42cf-9540-8955a01660dd","type":"Radio","nameid":"r_old4","group":"radiogroup1","left":170,"top":190,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"e471c016-9f34-42a3-95a4-d740b3106e5e","type":"Radio","nameid":"r_old5","group":"radiogroup1","left":170,"top":235,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"cbeed146-d86a-43f8-8803-8579f78dd331","type":"Radio","nameid":"r_old6","group":"radiogroup1","left":170,"top":280,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"f22e35b8-606e-4ee7-959b-1c503c33714c","type":"Label","nameid":"label6","left":193,"top":100,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"lowest to","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"760040d6-7303-4809-9419-27a1fd6feb49","type":"Input","nameid":"i_from","left":190,"top":141,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"5f25cc1a-b75b-4b13-9ca0-640b000342e8","type":"Label","nameid":"label7","left":241,"top":145,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"to","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"5e6348e4-7460-432c-b956-231b584572ee","type":"Input","nameid":"i_tohighest","left":190,"top":186,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"a06c11cf-6d91-4abd-b6dd-70c203f5c879","type":"Label","nameid":"label8","left":241,"top":190,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"to highest","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"da8bb8e4-547f-4fe3-84e7-a1ef9be97a02","type":"Label","nameid":"label9","left":193,"top":235,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"missing (empty NA)","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"fdeadc81-adcd-403a-bf4a-7e049ee3c5e1","type":"Label","nameid":"label10","left":193,"top":280,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"all other values","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"774c8c89-32d7-46b0-a9f4-f16ab084367d","type":"Separator","nameid":"separator1","left":325,"top":38,"width":1,"height":265,"direction":"vertical","color":"#b8b8b8","isEnabled":true,"isVisible":true,"elementIds":"","borderColor":"undefined"},{"id":"b30d7944-24b9-444f-bffb-ba2d216d0f05","type":"Label","nameid":"label11","left":352,"top":20,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"New value:","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"8b41d2b3-215f-4fdd-8541-54576fdda5c9","type":"Input","nameid":"i_value_old","left":242,"top":51,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"a64af3d0-d052-41a6-8794-2b48851e45e6","type":"Input","nameid":"i_lowesto","left":257,"top":96,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"dbf05ba9-ccf3-44b4-af52-463a959cdfda","type":"Input","nameid":"i_to","left":257,"top":141,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"5a27cf92-04df-4038-92ec-8f7faf0ae095","type":"Checkbox","nameid":"checkbox1","left":23,"top":334,"size":14,"fill":true,"color":"#70a470","isChecked":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"1a97e8be-9d02-4a02-bd69-300a90eee73b","type":"Label","nameid":"label3","left":45,"top":325,"maxWidth":80,"lineClamp":2,"fontColor":"#000000","value":"recode into new condition","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"eb534da0-d8ee-4e39-9e67-ea687ba290a5","type":"Input","nameid":"i_newvar","left":134,"top":329,"width":150,"value":"","valueType":"String","isEnabled":true,"isVisible":false,"elementIds":""},{"id":"e89b2ae1-571c-4a16-8848-9676b66a9617","type":"Radio","nameid":"r_new1","group":"radiogroup2","left":351,"top":55,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"2674234c-4b25-4bf5-aeff-6e77805bf433","type":"Radio","nameid":"r_new2","group":"radiogroup2","left":351,"top":85,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"e4587f04-66e7-4b0e-8fd0-5af0b9d054ee","type":"Radio","nameid":"r_new3","group":"radiogroup2","left":351,"top":115,"size":14,"color":"#589658","isSelected":false,"isEnabled":true,"isVisible":true,"elementIds":""},{"id":"66a3825a-ab1b-4550-832b-b3378369f512","type":"Label","nameid":"label12","left":373,"top":55,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"value","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"9e2e17f1-e484-4951-9223-1fb9568512e0","type":"Input","nameid":"i_value_new","left":411,"top":51,"width":45,"value":"","valueType":"String","isEnabled":true,"isVisible":true,"elementIds":""},{"id":"fe754a15-3852-43ca-8544-1627a36beb3b","type":"Label","nameid":"label13","left":373,"top":85,"maxWidth":220,"lineClamp":1,"fontColor":"#000000","value":"missing (empty NA)","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"8f0e4bfb-a9e6-4149-a850-b96e4f800859","type":"Label","nameid":"label14","left":373,"top":115,"maxWidth":200,"lineClamp":1,"fontColor":"#000000","value":"copy old value(s)","align":"left","isEnabled":true,"isVisible":true,"elementIds":"","fontSize":12},{"id":"6d101556-6637-4519-8d75-906d9751a997","type":"Container","nameid":"c_variables","left":20,"top":178,"width":130,"height":125,"selection":"single","itemType":"numeric","backgroundColor":"#ffffff","fontColor":"#000000","activeBackgroundColor":"#589658","activeFontColor":"#ffffff","disabledBackgroundColor":"#dedede","borderColor":"#b8b8b8","isEnabled":true,"isVisible":true,"elementIds":""}]}